dist: trusty
sudo: true
services:
- docker
language: node_js
node_js:
- '8.8'
install:
- npm install
before_script:
- DOCKER_IMAGE_NAME="q-election-seats"
- DOCKER_TAG=$TRAVIS_BRANCH
script:
- npm run build
- npm test
- docker build -t $DOCKER_IMAGE_NAME:$DOCKER_TAG .
- docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"; docker tag $DOCKER_IMAGE_NAME:$DOCKER_TAG
  nzzonline/$DOCKER_IMAGE_NAME:$DOCKER_TAG; docker push nzzonline/$DOCKER_IMAGE_NAME:$DOCKER_TAG;
- if [ "$TRAVIS_BRANCH" == "staging" ] && [ $TRAVIS_PULL_REQUEST == "false" ]; then docker run --rm -it -e RANCHER_URL -e CATTLE_ACCESS_KEY 
  -e CATTLE_SECRET_KEY etlweather/gaucho upgrade $RANCHER_SERVICE_ID_STAGING --auto_complete 
  --start_first --imageUuid="docker:nzzonline/$DOCKER_IMAGE_NAME:$DOCKER_TAG" || true; 
  fi
cache:
  directories:
  - node_modules
notifications:
  slack:
    secure: 61rov1Nijs9J7TMEdO/hnZNq9FpcDfSGDLphBj206qwT2C0Oxu42fQD3P5iOp7yrr75InKX7gVOHGTOZS5vCvH62GNzR6ZytC2O+X9IMPweuDQPaAOS1R6g5uRZ9WIedTVKKLJ8a0UsCuWl+EhHfBr0Z8YHbR2XiaUWY+KQUsaXDvfOAYhFwnFntIXNcdCkcJt6pby+OpMRZ4MEEp51ge1+odD8qCOmIsBODGgz2P6Ua68Okrdgk02s6OzNKqkHMF6MxBEBQpmjeKfzSbtfaLve4nllEw2xzaZlqcNNxr/KMRRarZlgE1HG1I1ikEW1EmIgIkPwpwcDTnhEyZcJWDomMoAkJl3LJILfp3NS2EOoOILquez+I7h5QY7MCeolJIS+R3JolhRDOhOg2RqyB+FXq/uZcXB1e4oNQZCNl4rMaDz4H8z8OuLAMDVVVCNYSFgstEmR8oRDAz8lPFciA2jRYyNTD7UDa91Hrw7xpe2oCpKXy6D2RhctWAeeDOyxp1lm9ZK9ORvzqRQRqBkoudqeLCmf4DeSS6IMkIRZMMY+XlGOsAoj//ailQp1A1i9ujuym/XCyBJx5VTSpfUkPT0i0RoDuRltTOlD5N84Rq5LFImgV8aOLh5wN1bwRVH/eYUwdFydow79J/0nMmvb2Sa1L0VwXdBukMW0vuau3GMM=
